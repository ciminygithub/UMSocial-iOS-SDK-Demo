<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
}
</style>
<title>**iOS Social SDK使用指南**</title>

</head>
<body>
<h1><strong>iOS Social SDK使用指南</strong></h1>

<p> <font color="red">重要通知：原“SNS分享组件”已全面升级，并更名为“友盟社会化组件”。除原有功能外，新组件还支持分享至QQ空间、豆瓣、微信等新功能，并新增了“登录”、“评论”、“喜欢”等社会化功能。</font></p>

<h3><a href="#product_guide" style="text-decoration:none">1. 产品概述</a></h3>

<h3><a href="#quick_guide" style="text-decoration:none">2. 快速集成指南</a></h3>

<blockquote><p><a href="#sign_in_umengkey" style="text-decoration:none">2.1 申请友盟应用标识</a></p>

<p><a href="#binding_config" style="text-decoration:none">2.2 申请友盟应用标识</a></p>

<p><a href="#quick_use" style="text-decoration:none">2.3 快速集成分享功能</a></p></blockquote>

<h3><a href="#develop_guide" style="text-decoration:none">3. 开发指南</a></h3>

<blockquote><p><a href="#social_bar" style="text-decoration:none">3.1 社会化操作栏</a></p>

<p><a href="#social_user" style="text-decoration:none">3.2 用户账号</a></p>

<p><a href="#social_share" style="text-decoration:none">3.3 分享</a></p>

<p><a href="#social_comment" style="text-decoration:none">3.4 评论</a></p>

<p><a href="#social_like" style="text-decoration:none">3.5 喜欢</a></p></blockquote>

<h3><a href="#faq" style="text-decoration:none">4. FAQ</a></h3>

<blockquote><p><a href="#social_config" style="text-decoration:none">1. 分享列表页面或者登录页面，如何不显示不想要的sns平台或者增加平台？</a></p>

<p><a href="#faq_orientation" style="text-decoration:none">2. 如何指定页面支持的某一屏幕方向？</a></p>

<p><a href="#faq_debug" style="text-decoration:none">3. 如何处理SDK出现的错误？</a></p>

<p><a href="#faq_oauth" style="text-decoration:none">4. 如何判断用户有没有授权到一个微博平台？</a></p>

<p><a href="#faq_identifer" style="text-decoration:none">5. 初始化<code>UMSocialData</code>用到的<code>identifier</code>代表什么意思？</a></p>

<p><a href="#faq_usercenter" style="text-decoration:none">6. 个人中心页面上面的登录账号和下面的授权账号有什么关系？</a></p>

<p><a href="#faq_wechart" style="text-decoration:none">7. 如何集成微信？</a></p></blockquote>

<h3><a href="#error_code" style="text-decoration:none">5. 附录</a></h3>

<h2><a name="product_guide" id="product_guide" style="color:black">1.产品概述</a></h2>

<p>友盟社会化分享服务帮助你为你的用户提供社会化分享功能，连接用户和他的社会关系，方便他们分享在你的应用中的精彩体验。</p>

<ol>
<li>评论,用户可以使用自己的微博账号或者匿名评论到应用自己的评论列表中。用户输入评论时可以选择分享自己的地理位置信息。同时评论时可以选择分享到任意微博平台。</li>
<li>转发到微博，用户可以转发信息到任意微博。</li>
<li>喜欢，点击喜欢按钮，看到喜欢数量。</li>
<li>用户账户管理，对任意微博平台授权一个账户，绑定任意一个微博账户作为评论账号。</li>
</ol>


<h2><a name="quick_guide" id="quick_guide" style="color:black">2.快速集成指南</a></h2>

<p>社会化组件iOS版<a href="http://v.youku.com/v_show/id_XNDg4MTQ2MDMy.html">集成视频</a>，请将播放器的清晰度切换为超清。</p>

<h3>2.1 <a name="sign_in_umengkey" id="sign_in_umengkey" style="color:black">申请友盟应用标识</a></h3>

<p>   如果你之前已经在友盟注册了应用，获得了<code>UMENG_APPKEY</code>，可以继续使用之前获得<code>UMENG_APPKEY</code>。 <br/>
   如果你尚未在友盟注册应用，你可以登录你的账号，点击<strong>添加新应用</strong>，完成新应用填写之后，讲进入应用管理页面。在该页面就能得到<code>Appkey</code>。</p>

<h3>2.2 <a name="biding_config" style="color:black">绑定友盟应用标识与各开放平台</a></h3>

<p>   获得appkey后，你还需要将你的应用和我们支持的分享平台注册时获取的appkey和appsecret进行绑定。由于QQ空间、新浪微博、腾讯微博、人人网、豆瓣各个平台注册app的方法很有可能有变化，你可以参考我们线上版本的开发文档有关各个平台注册方法：</p>

<p> <a href="http://dev.umeng.com/doc/document_social_ios.html" title="开发文档">iOS Social SDK 在线文档</a></p>

<h3>2.3 <a name="quick_use" id="quick_use" style="color:black">快速集成分享功能</a></h3>

<h4>Step1: 添加SDK到你的工程</h4>

<p><img src="http://dev.umeng.com/images/ios/social_add_files.png" title="Add_files" alt="alt text" /></p>

<p>下载SDKzip包，并解压。在你的Xcode工程选择添“Add Files to xxxx”，选择解压文件夹中<code>UMSocial_Sdk_x.x.x/</code>(x.x.x是具体版本号），勾上下面的"Copy items ……"，还有选择你要添加到target。如果你只集成分享功能的话，可以把<code>UMSocialCommentLibrary.a</code>从你的工程删除。</p>

<h4>Step2: 调用友盟社会化组件</h4>

<p>在你要出现分享列表的地方<code>#import "UMSocialSnsService.h"</code>并调用 <code>UMSocialSnsService</code>的这个方法：</p>

<pre><code>+(void)presentSnsController:(UIViewController *)controller appKey:(NSString *)appKey shareText:(NSString *)shareText shareImage:(UIImage *)shareImage shareToSnsNames:(NSArray *)snsNames delegate:(id &lt;UMSocialUIDelegate&gt;)delegate;
</code></pre>

<p>即会弹出一个分享列表页面</p>

<p><img src="http://dev.umeng.com/images/ios/social_sharelist.png" title="ShareList" alt="alt text" /></p>

<table>
<thead>
<tr>
<th>形参名</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>controller</td>
<td>分享列表页面所在的UIViewController对象</td>
</tr>
<tr>
<td>appKey</td>
<td>友盟appKey，如果你在其他地方用<code>UMSocialData</code>设置了appKey，这里也可以传nil</td>
</tr>
<tr>
<td>shareText</td>
<td>分享编辑页面的内嵌文字</td>
</tr>
<tr>
<td>shareImage</td>
<td>分享编辑页面的内嵌图片，用户可以删除</td>
</tr>
<tr>
<td>snsNames</td>
<td>定义列表出现的sns平台，由SDK中定义好的平台名字符串组成的数组，可以定义列表视图中分组中的每个列表项，例如传入的数组是<code>@[@[UMShareToSina,UMShareToTencent],@[UMShareToWechart]];</code>上面分组是新浪微博、腾讯微博、下面分组是微信。如果设为nil的话出现所有平台</td>
</tr>
<tr>
<td>delegate</td>
<td>实现分享状态回调方法的对象</td>
</tr>
</tbody>
</table>


<p>如果您希望单独使用友盟社会化组件提供的功能，或者希望更深层次的功能和UI定制，请移步至下一章节——“开发指南”部分。</p>

<h2><a name="develop_guide" id="develop_guide" style="color:black">3.开发指南</a></h2>

<h3>3.1 <a name="social_bar" id="social_bar" style="color:black">社会化操作栏</a></h3>

<p><img src="http://dev.umeng.com/images/ios/socialBar_white.png" title="socialbar" alt="socialbar" /></p>

<p>这是个放置在APP底部的通用工具栏，它为用户提供了针对特定内容页的一站式社会化功能（评论、喜欢、分享、个人中心4个功能）。</p>

<p>1.设置SDK的<code>UMENG_APPKEY</code>，在 <code>AppDelegate</code>文件<code>#import "UMSocialData.h"</code>然后在<code>didFinishLaunchingWithOptions</code>方法内设置你的友盟AppKey：
<code>[UMSocialData setAppKey:UMENG_APPKEY];</code></p>

<p>2.使用社会化操作栏非常简单——实例化一个“社会化操作服务”，并将其“社会化操作栏”变量添加到您的视图控制器中即可。代码如下：</p>

<pre><code>- (void)viewDidLoad{
    [super viewDidLoad];
    UMSocialData *socialData = [[UMSocialData alloc] initWithIdentifier:@"your identifier"];
    UMSocialBar *socialBar = [[UMSocialBar alloc] initWithUMSocialData:socialData withViewController:self];
    socialBar.center = CGPointMake(160, 390);
    [self.view addSubview:socialBar];
}  
</code></pre>

<h3>3.2 <a name="social_user" id="social_user" style="color:black">用户账号</a></h3>

<h4>1 简介</h4>

<p>每个使用社会化组件的设备都会对应一个“用户”，但是组件会为您自动处理“用户”对象，您无需显式创建它。
    用户信息分两部分：
登录信息： APP内部展示给其他用户的个人信息。系统会将用户登录时选择的默认平台上的授权信息，作为用户的登录信息；
授权信息：从各开放平台上获得的个人资料，如昵称、头像等。</p>

<h4>2 用户中心（界面级接口）</h4>

<p>个人中心页面，个人中心页面，上面是绑定一个微博账号作为SDK的登录账号，简称为登录账号，下面是各个已经授权的微博账号，包括我们支持的所有平台，可以对各个平台进行授权和解除授权。</p>

<p><img src="http://dev.umeng.com/images/ios/social_user_account.png" title="socical_user_account" alt="socialbar" /></p>

<p>实现的代码是</p>

<pre><code>UMSocialControllerService *socialControllerService = [[UMSocialControllerService alloc] initWithUMSocialData:[UMSocialData defaultData]];
UINavigationController *accountViewController =[socialControllerService getSocialAccountController];
[self presentModalViewController:accountViewController animated:YES];
</code></pre>

<h4>3 获取用户微博账号信息（数据级的接口）</h4>

<p>获取用户微博基本信息的接口</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestSocialAccount];
</code></pre>

<p>并设置实现回调函数的对象</p>

<pre><code>[socialControllerService.socialDataService setUMSocialDelegate:self];
</code></pre>

<p>在<code>-(void)didFinishGetUMSocialDataResponse:(UMSocialResponseEntity *)response
</code>方法内的<code>response</code>对象的<code>data</code>属性可以获取到各个授权的微博账号的基本信息，包括性别、头像、页面url、用户名、用户id。</p>

<p><strong>注意</strong> 如果你在一个视图设置了<code>setUMSocialDelegate</code>为self，在离开此视图的时候要用<code>setUMSocialDelegate</code>设置为nil，否则会出现离开视图被释放找不到delegate的情况。</p>

<p>如果想获取本地缓存的用户信息，可以直接用<code>UMSocialData</code>的<code>socialAccount</code>属性，它是一个<code>NSDictionary</code>对象。键为各个微博平台名称，我们把他们定义好为常量字符串<code>UMShareToSina</code>、<code>UMShareToTencent</code>……值为<code>UMSocialAccountEntity</code>对象。</p>

<p>如果想获取各个微博账号详细的信息，可以调用<code>UMSocialDataService</code>的<code>- (void)requestSnsInfomation:(UMShareToType)shareToType;</code>方法。同样在回调方法来得到用户微博数据。</p>

<h4>4 授权页面（界面级接口）</h4>

<p>sdk实现调用微博授权页面</p>

<p><img src="http://dev.umeng.com/images/ios/social_oauth.png" title="socical_oauth" alt="socialbar" /></p>

<p>实现代码是</p>

<pre><code>//如上对socialControllerService进行初始化
UINavigationController *oauthController = [socialControllerService getSocialOauthController:shareToType];
[self presentModalViewController:oauthController animated:YES];
</code></pre>

<p>授权完成的回调函数</p>

<pre><code>socialControllerService.soicalUIDelegate = self;      //设置回调对象
//实现回调方法
-(void)didFinishGetUMSocialDataInViewController:(UMSocialResponseEntity *)response
{
    if (response.viewControllerType == UMSViewControllerOauth) {
        ……
        NSLog(@"didFinishOauthAndGetAccount response is %@",response);
    }
}
</code></pre>

<h4>5 其他用户操作 （数据级接口）</h4>

<p>实现解除授权</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestUnOauthWithType:shareToType];
</code></pre>

<p>实现绑定一个登录账号，此登录账号为sdk内用户评论时使用的昵称和头像。如果要绑定的平台一定为已经授权的微博平台，否则无法正常绑定</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestBindToSnsWithType:shareToType];
</code></pre>

<p>实现解除绑定此登陆
账号</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestUnOauthWithType:shareToType];
</code></pre>

<p>获取用户微博账号详细信息，包括各平台的uid和accestoken，各个平台不一样，腾讯微博有openid</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestSnsInfomation:shareToType];
</code></pre>

<p>获取用户好友列表，支持新浪微博、腾讯微博、人人网</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestSnsFriends:shareToType];
</code></pre>

<p>添加关注，支持新浪微博、腾讯微博，可以同时传多个关注微博账号</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService requestAddFollow:shareToType followedUsid:[NSArray arrayWithObjects:@"1920318374", nil]];
</code></pre>

<h3>3.3 <a name="social_share" id="social_share" style="color:black">分享</a></h3>

<h4>1 界面级的接口</h4>

<p>分享列表页面</p>

<p><img src="http://dev.umeng.com/images/ios/social_sharelist.png" title="ShareList" alt="alt text" /></p>

<p>实现代码是</p>

<pre><code>UMSocialData *socialData = [[UMSocialData alloc] initWithIdentifier:@"test"];
UMSocialControllerService *socialControllerService = [[UMSocialControllerService alloc] initWithUMSocialData:socialData];
UINavigationController *shareListController = [socialControllerService getSocialShareListController];
[self presentModalViewController:shareListController animated:YES];
</code></pre>

<p>如果你要设置在分享编辑页面出现的内嵌文字和图片，代码是
<code>
socialData.shareText = @"分享内嵌文字";
socialData.image = [UIImage imageNamed:@"icon.png"];
</code></p>

<blockquote><p><strong>注意</strong>:如上面截图所示表格的最后一个单元格，的微信分享不是SDK提供的分享功能，不过利用SDK提供了一个<code>&lt;UMSocialUIDelegate&gt;</code>的协议，并用此方法<code>- (void)setUMSocialUIDelegate:(id &lt;UMSocialUIDelegate&gt;)soicalUIDelegate;</code>设置实现了此协议的对象。其中实现<code>-(UITableViewCell *)customCellForShareListTableView;</code>方法可以自定义如图所示的效果，实现<code>-(void)didSelectShareListTableViewCell;</code>方法是点击此单元格的操作。如果要实现微信的分享，可以参见我们的demo。</p></blockquote>

<p>分享微博编辑页面</p>

<p><img src="http://dev.umeng.com/images/ios/social_shareedit.png" title="social_share_edit" alt="socialbar" /></p>

<pre><code>//如上对socialControllerService进行初始化
UINavigationController *shareEditController = [socialControllerService getSocialShareEditController:shareToType];
[self presentModalViewController:shareEditController animated:YES];
</code></pre>

<p>获得界面级回调函数</p>

<p>设置回调对象<code>socialControllerService.soicalUIDelegate = self;</code>
实现回调方法,根据<code>response</code>的<code>viewControllerType</code>判断页面类型，根据<code>responseCode</code>判断成功与否，<code>viewControllerType</code>和<code>responseCode</code>的定义见头文件和API文档，如果你需要知道错误具体原因可以查看<code>response</code>的<code>message</code>信息。</p>

<pre><code>-(void)didFinishGetUMSocialDataInViewController:(UMSocialResponseEntity *)response
{
    if (response.viewControllerType == UMSViewControllerShareEdit) {
        ……
        NSLog(@"didFinishGetUMSocialDataInViewController is %@",response);        
    }
}
</code></pre>

<h4>2 数据级接口</h4>

<p>直接发送微博到对应的微博平台</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService postSNSWithType:shareToType usid:nil content:@"shareContent" image:nil location:nil];
</code></pre>

<p>其中<code>usid</code>为分享用的相应的微博平台的id号，如果不传的话而此微博平台使用了sdk来进行授权过的话，会自动用授权后的usid进行发送，如果传过来会优先用此usid号。<code>image</code>为分享的图片，<code>location</code>为分享地理位置对象。这三个参数可以为空。</p>

<p>同获取微博账号数据一样，如果要得到发送微博完成的事件，要实现<code>&lt;UMSocialDataDelegate&gt;</code>的<code>-(void)didFinishGetUMSocialDataResponse:(UMSocialResponseEntity *)response
</code>方法。你需要判断回调类型<code>responseTye</code>是否是分享的回调，如果要判断微博分享成功与否，要对<code>response</code>里面<code>responseCode</code>作判断，如果你需要知道错误具体原因可以查看<code>response</code>的<code>message</code>信息。<code>responseCode</code>、<code>responseType</code>类型见头文件和API文档。</p>

<p>同时发送到多个微博平台,传入各个平台类型和分享到的用户uid，如果使用我们sdk授权过的平台也可以不传uid</p>

<pre><code>[socialControllerService.socialDataService postSNSWithType:allSnsArray usids:nil  content:shareContent image:image location:location];
</code></pre>

<p>获取分享数</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService.socialData requestSocialData];
</code></pre>

<p>同样在回调方法中可以<code>response</code>对象的类型是<code>NSDictioanry</code>的<code>data</code>属性中，其中键为<code>sn</code>的代表分享数。</p>

<p>你也可以获取缓存在本地的分享数</p>

<pre><code>[socialControllerService.socialDataService.socialData getNumber:UMSNumberShare];
</code></pre>

<h4>3 分享常见错误</h4>

<p>在回调方法<code>-(void)didFinishGetUMSocialDataResponse:(UMSocialResponseEntity *)response
</code>中的<code>response</code>中的<code>responseCode</code>和<code>message</code>可以得到返回状态码，和错误消息。</p>

<p>注意如果<code>responseCode</code>为<code>5027</code>的话，<code>message</code>是<code>Sina access token expired, please do oauth(rebind account) again</code>,表示授权过期，需要重新打开授权页面进行授权。</p>

<h3>3.4 <a name="social_comment" id="social_comment" style="color:black">评论</a></h3>

<h4>1 界面级接口</h4>

<p>用到评论的界面级功能，需要使用<code>UMSocialCommentLibrary.a</code>,对应的头文件是<code>UMSocialControllerServiceComment.h</code>。</p>

<p>评论列表</p>

<p><img src="http://dev.umeng.com/images/ios/social_commentlist.png" title="socical_comment_list" alt="socialbar" /></p>

<pre><code>UMSocialControllerServiceComment * socialControllerComment = [[UMSocialControllerServiceComment alloc] initWithUMSocialData:socialData];
UINavigationController *commentList = [socialControllerComment getSocialCommentListController];
[self presentModalViewController:commentList animated:YES];
</code></pre>

<p>由于我们发送评论还提供了同步分享到各个微博的功能。你可以设置评论并分享到微博的内嵌文字和图片，此文字出现在微博正文之后以<code>//</code>分隔,例如下面的设置，用户发送了“评论内容”并分享到微博之后效果是“评论内容//评论内嵌文字"
<code>
socialControllerComment.socialData.commentText = @"评论内嵌文字";
socialControllerComment.socilaData.commentImage = [UIImage imageNamed:@"icon.png"];
</code></p>

<h4>2 数据级接口</h4>

<p>评论的数据级接口不需要<code>UMSocialCommentLibrary.a</code>。获取最近的评论数据：</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService requestCommentList:(-1)];
</code></pre>

<p>如果评论数据比较多，想获取之前的评论，可以在<code>- (void)requestCommentList:(long long)lastCommentTime;</code>中传入指定时间戳之前的评论，具体每条评论的时间戳可以在回调方法<code>-(void)didFinishGetUMSocialDataResponse:(UMSocialResponseEntity *)response
</code>中的<code>response</code>中得到。</p>

<p>添加一条文本评论</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService postCommentWithContent:@“comment content”];
</code></pre>

<p>添加一条评论，并添加地理位置信息，或者分享到微博平台，可以带有图片</p>

<pre><code>//如上对socialControllerService进行初始化
NSDictionary *shareToSNS = [NSDictionary dictionaryWithObjectsAndKeys:@"weiboid",@"sina",nil];
[socialControllerService.socialDataService postCommentWithContent:@"comment content" location:location shareToSNSWithUsid:shareToSNS];
</code></pre>

<p>获取评论数</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService.socialData requestSocialData];
</code></pre>

<p>同样在回调方法中可以<code>response</code>对象的类型是<code>NSDictioanry</code>的<code>data</code>属性中，其中键为<code>cm</code>的代表分享数。</p>

<p>你也可以获取缓存在本地的评论数</p>

<pre><code>[socialControllerService.socialDataService.socialData getNumber:UMSNumberComment]
</code></pre>

<h3>3.5 <a name="social_like" id="social_like" style="color:black">喜欢</a></h3>

<h4>1.不带界面的接口</h4>

<p>发送一个喜欢的请求，或者如果已经喜欢过的话，发送取消喜欢的请求</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService postAddLikeOrCancel];
</code></pre>

<p>同样发送喜欢之后的回调函数实现和其他操作一样，实现<code>-(void)didFinishGetUMSocialDataResponse:(UMSocialResponseEntity *)response</code>方法并根据<code>response</code>的<code>responseCode</code>和<code>responseType</code>判断回调结果和回调类型</p>

<p>获取喜欢数</p>

<pre><code>//如上对socialControllerService进行初始化
[socialControllerService.socialDataService.socialData requestSocialData];
</code></pre>

<p>同样在回调方法中可以<code>response</code>对象的类型是<code>NSDictioanry</code>的<code>data</code>属性中，其中键为<code>lk</code>的代表分享数。</p>

<p>你也可以获取缓存在本地的评论数</p>

<pre><code>[socialControllerService.socialDataService.socialData getNumber:UMSNumberLike]
</code></pre>

<h2><a name="FAQ" id="FAQ" style="color:black">4. FAQ</a></h2>

<h3>1. <a name="faq_config" id="social_config" style="color:black">分享列表页面或者登录页面，如何不显示不想要的sns平台或者增加平台？</a></h3>

<p>可以自己指定在AppDelegate 的<code>didFinishLaunchingWithOptions</code> 方法内添加如下代码：
<code>
[UMSocialControllerService setSocialConfigDelegate:self];
</code>
并且实现<code>UMSocialConfigDelegate</code>的<code>shareToPlatforms</code>方法，数组里的字符串定义在<code>UMSocialEnum.h</code>，可以使用的分享平台包括新浪微博<code>UMShareToSina</code>、腾讯微博<code>UMShareToTencent</code>、QQ空间<code>UMShareToQzone</code>、人人网<code>UMShareToRenren</code>、豆瓣<code>UMShareToDouban</code>、微信<code>UMShareToWechart</code>、Facebook<code>UMShareToFacebook</code>、Twitter<code>UMShareToTwitter</code>、邮箱<code>UMShareToEmail</code>、短信<code>UMShareToSms</code>。</p>

<pre><code>- (NSArray *)shareToPlatforms
{
    NSArray *shareToArray = @[@[UMShareToQzone,UMShareToWechart,UMShareToSina,UMShareToTencent],@[UMShareToEmail,UMShareToSms]];
    return shareToArray;
}
</code></pre>

<p>像这样返回的一个NSArray，里面两个NSArray，每一个代表分享列表页面每组单元格出现的分享平台，你也可以指定NSArray里面直接指定平台，就只有一组，例如<code>NSArray *shareToArray = @[UMShareToSina,UMShareToTencent];</code>。</p>

<p>你可以增加自定义的分享平台，例如在刚才返回的shareToArray中增加分享到微信，我们定义微信的标识是<code>@"weixin"</code>，指定平台数组是<code>NSArray *shareToArray = @[@"weixin",UMShareToSina,UMShareToTencent];</code>。然后实现的<code>UMSocialConfigDelegate</code>的<code>-(UMSocialSnsPlatform *)socialSnsPlatformWithSnsName:(NSString *)snsName;
</code>方法，指定这个平台的平台名、平台图片、点击后的响应行为等。</p>

<pre><code>-(UMSocialSnsPlatform *)socialSnsPlatformWithSnsName:(NSString *)snsName
{
    UMSocialSnsPlatform *customSnsPlatform = nil;
    if ([snsName isEqualToString:@"weixin"]) {
        //分享到微信
    }
    return customSnsPlatform;
</code></pre>

<h3>2. <a name="faq_orientation" id="faq_orientation" style="color:black">如何指定页面支持的某一屏幕方向？</a></h3>

<p>如果你想指定sdk相关的页面支持某一方向，首先设置实现<code>&lt;UMSocialConfigDelegate&gt;</code>的回调对象<code>[UMSocialControllerService setSocialConfigDelegate:self];</code>，然后实现回调方法<code>- (NSUInteger)supportedInterfaceOrientationsForUMSocialSDK</code>，返回的是iOS6定义的<code>UIInterfaceOrientationMask</code>类型，例如指定屏幕支持全部方向：</p>

<pre><code>- (NSUInteger)supportedInterfaceOrientationsForUMSocialSDK
{
    return UIInterfaceOrientationMaskAll;
}
</code></pre>

<h3>3. <a name="faq_debug" id="faq_debug" style="color:black">如何处理SDK出现的错误？</a></h3>

<p>由于社会化组件功能需要依赖新浪微博、腾讯微博、QQ空间、人人网和友盟服务器的服务，和微信等SDK的功能，还有SDK本身也在不断地改进升级，出现各种错误在所难免。</p>

<ol>
<li><p>不管出现什么错误，为了方便看到错误原因，都可以先打开log，<code>[UMSocialData openLog:YES];</code>。在log的输出中，我们可以看到每次网络请求状态，如果是失败的话，可以看到状态码，失败原因，还有每次网络请求的url。</p></li>
<li><p>如果是分享失败的话，除了已知错误，例如授权过期会自动处理之外，其他错误界面上都只会弹出对话框显示“由于网络原因，信息发送失败”，而分享失败的原因，你可以通过在log中看到，或者在回调方法里的<code>responseCode</code>和<code>message</code>得到错误码和错误原因。错误的原因主要有以下几种：</p>

<blockquote><p>a.和平台设置相关的原因，例如QQ空间需要开通相应的权限、没有通过新浪微博审核通过的应用，需要添加测试用户等。</p>

<p>b.各平台定义的发送方式错误，例如新浪微博和腾讯微博返回发送微博太频繁。</p></blockquote></li>
<li><p>如果是sdk出现crash等异常，可以发送邮件到social-support@umeng.com，我们会尽快回复您。</p></li>
</ol>


<h3>4. <a name="faq_oauth" id="faq_oauth" style="color:black">如何判断用户有没有授权到一个微博平台</a></h3>

<p>如果利用SDK授权用户，我们会把用户的授权信息保存在SDK本地，你可利用<code>UMSocialAccountManager</code>,的类方法<code>+ (BOOL)isOauthWithPlatform:(NSString *)platformName;</code>,传入在<code>UMSocialEnum.h</code>定义的平台名，就可以返回是否已经授权。例如<code>[UMSocialAccountManager isOauthWithPlatform:UMShareToSina];</code>就能返回是否已经授权新浪微博。</p>

<h3>5. <a name="faq_identifer" id="faq_identifier" style="color:black">初始化<code>UMSocialData</code>用到的<code>identifier</code>代表什么意思？</a></h3>

<p>调用数据级接口和界面级接口需要一个<code>UMSocialData</code>对象，一个<code>UMSocialData</code>对象标识一个分享资源，而<code>UMSocialData</code>对象用一个<code>identifier</code>字符串来初始化并标识这个对象，你可以为此对象设置分享内嵌文字、分享图片等，可以在SDK获取到对应的分享数。也可以在后台报表，很清楚地看到每个分享资源的分享次数，和每个用户在分享次数。如果你用了评论和喜欢功能，也可以在SDK得到评论、喜欢数字和在报表看到相应的评论、喜欢行为和次数。</p>

<h3>6. <a name="faq_usercenter" id="faq_usercenter" style="color:black">个人中心页面上面的登录账号和下面的授权账号有什么关系？</a></h3>

<ol>
<li>个人中上半部分是登录账号、下半部分是授权账号。所谓登录账号，即我们SDK讲一个sns的授权账号作为绑定账号，我们在评论时候就会使用此登录账号的用户名和头像。下半部分就是各个sns平台的授权信息，可以显示每个平台是否授权和昵称。</li>
<li>用户即使在下面解授权，也不会影响到上面的登录状态，而如果你需要解除登录，可以调用我们的数据级接口。</li>
<li>如果你不想出现个人中心上面部分，只想要下面的授权信息，可以调用<code>UMSocialControllerService</code>的<code>- (UINavigationController *)getSnsAccountController;</code>方法。</li>
<li>如果你想设置个人中心出现哪些sns平台，请参见问题1，即那里设置的出现平台就会影响到个人中心出现的平台和登录页面出现的平台。</li>
</ol>


<h3>7. <a name="faq_wechart" id="faq_wechart" style="color:black">如何集成微信？</a></h3>

<p>因为当前微信还不能通过网站的开放接口来分享给微信好友，所以我们只能利用微信的iOS SDK来做分享。使用我们当前版本的SDK集成微信的方式，步骤如下：
1. 在微信网站注册，得到微信开发者id，并在<code>AppDelegate</code>引入头文件<code>#import "WXApi.h"</code>，然后注册，例如<code>[WXApi registerApp:@"wxd9a39c7122aa6516"];</code>.
2. 在FAQ的问题1，设置出现微信，你可以指定微信出现在分享列表的任意位置，例如问题1中的示例代码，微信将出现在第一个分组的第二个单元格。
3. 在你的<code>AppDelegate</code>文件里面实现代理方法<code>- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url
</code>,调用微信SDK处理此url<code>[WXApi handleOpenURL:url delegate:self];</code>
如果你需要处理微信回调的状态，你还需要实现这个回调方法
<code>
- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation
{
    return  [WXApi handleOpenURL:url delegate:self];
}
</code>
并在微信定义的回调方法中处理，例如</p>

<pre><code>-(void) onResp:(BaseResp*)resp
{
    NSLog(@"req type is %d",resp.type);
    if([resp isKindOfClass:[SendMessageToWXResp class]])
    {
        ……
    }
}
</code></pre>

<p>最后需要添加URL scheme，在Xcode4中，选择你的工程设置项，选中“TARGETS”一栏，在“info”标签栏的“URL type“添加“URL scheme”为你所注册的应用程序id。如果使用的是Xcode3或更低版本，则需要在plist文件中添加。见 <a href="http://open.weixin.qq.com/document/gettingstart/ios/?lang=zh_CN" title="微信集成文档">微信使用指南</a> 介绍。</p>

<h2><a name="error_code" id="error_code" style="color:black">5. 附录</a></h2>

<h3>1常见错误代码含义</h3>

<table>
<thead>
<tr>
<th>错误码 </th>
<th> 错误原因</th>
</tr>
</thead>
<tbody>
<tr>
<td>500 </td>
<td> 给定uid的用户并不存在</td>
</tr>
<tr>
<td>501 </td>
<td> 绑定账户失败</td>
</tr>
<tr>
<td>502 </td>
<td> 解绑定失败</td>
</tr>
<tr>
<td>503 </td>
<td> 评论失败</td>
</tr>
<tr>
<td>504 </td>
<td> 获取评论失败</td>
</tr>
<tr>
<td>505 </td>
<td> 用户被加入黑名单</td>
</tr>
<tr>
<td>506 </td>
<td> 获取好友失败</td>
</tr>
<tr>
<td>507 </td>
<td> 获取授权url失败</td>
</tr>
<tr>
<td>508 </td>
<td> 解除授权失败</td>
</tr>
<tr>
<td>510 </td>
<td> 分享失败</td>
</tr>
<tr>
<td>511 </td>
<td> 获取bar失败</td>
</tr>
<tr>
<td>512 </td>
<td> 从平台获取用户信息失败</td>
</tr>
<tr>
<td>513 </td>
<td> url跳转失败</td>
</tr>
<tr>
<td>514 </td>
<td> 从social获取用户信息失败</td>
</tr>
<tr>
<td>515 </td>
<td> 请求的参数错误</td>
</tr>
<tr>
<td>516 </td>
<td> 请求喜欢失败</td>
</tr>
<tr>
<td>517 </td>
<td> 版本号错误</td>
</tr>
</tbody>
</table>


<h3>2分享错误代码</h3>

<table>
<thead>
<tr>
<th>错误码 </th>
<th> 错误原因</th>
</tr>
</thead>
<tbody>
<tr>
<td>5001 </td>
<td> 错误的友盟appkey，或者此appkey没有绑定任何平台.如果开发者绑定了，依然出现这个问题，让开发者再试一下，可能是刚绑定马上就测试的原因，最好等2分钟。</td>
</tr>
<tr>
<td>5002 </td>
<td>这个友盟appkey已经被禁止</td>
</tr>
<tr>
<td>5003 </td>
<td>请求的参数中没有uid</td>
</tr>
<tr>
<td>5004 </td>
<td>未知的错误，具体的错误信息会在log的输出中</td>
</tr>
<tr>
<td>5005 </td>
<td>访问频率超限，可一会儿再试</td>
</tr>
<tr>
<td>5006 </td>
<td>请求参数中没有content字段</td>
</tr>
<tr>
<td>5007 </td>
<td>请求参数中content字段的内容为空</td>
</tr>
<tr>
<td>5008 </td>
<td>没有上传图片</td>
</tr>
<tr>
<td>5009 </td>
<td>此友盟的appkey没有绑定对应平台的appkey和appsecret</td>
</tr>
<tr>
<td>5010 </td>
<td>userid无效，这个用户并没有进行授权</td>
</tr>
<tr>
<td>5013 </td>
<td>请求的参数中没有appkey这个字段</td>
</tr>
<tr>
<td>5014 </td>
<td>没有对此用户进行授权</td>
</tr>
<tr>
<td>5024 </td>
<td>获取access token失败，具体看log输出</td>
</tr>
<tr>
<td>5025 </td>
<td>获取request token失败，具体看log输出</td>
</tr>
<tr>
<td>5027 </td>
<td>授权已经过期</td>
</tr>
</tbody>
</table>


<h3>3技术支持</h3>

<p>请发邮件至social-support@umeng.com。如果您出现的问题和SDK相关，请说明您使用的是iOS的SDK，我们会尽快回复您。</p>
</body>
</html>