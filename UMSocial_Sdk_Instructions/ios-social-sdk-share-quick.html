<link rel="stylesheet" type="text/css" href="markdown.css"></link>
<h1>分享 快速集成</h1>
<h2>1 <a name="sign_in_umengkey" id="sign_in_umengkey" style="color:black"> 产品概述</a></h2>
<p>友盟社会化组件，可以让移动应用快速具备社会化分享、登录、评论、喜欢等功能，并提供实时、全面的社会化数据统计分析服务。</p>
<p><strong>指南将会手把手教你使用社会化组件SDK，用10分钟为APP增加新浪微博、腾讯微博、人人网分享功能。</strong></p>
<p><font color="red">注意：本文示例代码均针对最新版SDK，如果你所用SDK的类名或方法名与此文不符合，请使用你所用SDK的随包文档、或者下载使用最新版SDK。</font></p>
<h2>2 <a name="sign_in_umengkey" id="sign_in_umengkey" style="color:black"> 获取友盟Appkey</a></h2>
<ul>
<li>
<p>如果你之前已经在友盟注册了应用，并获取到了Appkey，可以继续使用它。   </p>
</li>
<li>
<p>如果你尚未在友盟注册开发者账号，需要先<a href="http://www.umeng.com/users/sign_up" style="text-decoration:none" target="_blank">注册</a>，注册之后登录你的账号，点击<strong>添加新应用</strong>，填写完应用基本信息后，将进入"下载SDK并添加代码"页面，此页面即可得到<code>Appkey</code>。</p>
</li>
</ul>
<h2>3 <a name="quick_use" id="quick_use" style="color:black">下载并安装SDK</a></h2>
<h3>Step1 下载SDK</h3>
<p>下载 <a href="http://dev.umeng.com/sdkdownload/sdkdownload_ios_social.html" style="text-decoration:none" target="_blank">最新版SDK</a></p>
<h3>Step2 加入SDK</h3>
<p>解压SDK压缩包，将形如UMSocial_Sdk_x.x.x的文件夹拖入工程目录：</p>
<p><img alt="alt text" src="http://dev.umeng.com/images/ios/social_drag_sdk.png" title="drag_sdk" /> </p>
<p>确认勾选了“Copy items to destination's group folder”选项，并选择你要添加到的Target: </p>
<p><img alt="alt text" src="http://dev.umeng.com/images/ios/social_check_tip.png" title="check_tip" /> </p>
<p>现在应该是这样的效果：</p>
<p><img alt="alt text" src="http://dev.umeng.com/images/ios/social_project_structure.png" title="project_structure" /> </p>
<h3>Step3 设置AppKey</h3>
<p>在AppDelegate内设置友盟AppKey</p>
<pre><code>#import &quot;UMSocial.h&quot;
……
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    [UMSocialData setAppKey:@&quot;507fcab25270157b37000010&quot;];
}
</code></pre>

<h3>Step4 添加实现代码</h3>
<p>打开需要集成分享功能的视图源码<code>UIViewController.m</code>，把如下代码复制并粘贴到你将弹出一个分享列表的位置，例如到响应分享按钮的方法中。并且修改下面的友盟appkey，你要分享的文字、图片，你要分享到的微博平台，例如下面写的是新浪微博、腾讯微博、人人网。</p>
<pre><code>#import &quot;UMSocial.h&quot;
……
[UMSocialSnsService presentSnsIconSheetView:self
                                     appKey:@&quot;507fcab25270157b37000010&quot;
                                  shareText:@&quot;你要分享的文字&quot;
                                 shareImage:[UIImage imageNamed:@&quot;icon.png&quot;]
                            shareToSnsNames:[NSArray arrayWithObjects:UMShareToSina,UMShareToTencent,UMShareToRenren,nil]
                                   delegate:nil]; 
</code></pre>

<table>
<thead>
<tr>
<th>形参名</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>controller</td>
<td>分享列表页面所在的UIViewController对象</td>
</tr>
<tr>
<td>appKey</td>
<td>友盟appKey，如果你在其他地方用<code>UMSocialData</code>设置了appKey，这里也可以传nil</td>
</tr>
<tr>
<td>shareText</td>
<td>分享编辑页面的内嵌文字</td>
</tr>
<tr>
<td>shareImage</td>
<td>分享编辑页面的内嵌图片，用户可以在编辑页面中删除。如果你不需要分享图片，可以传入<code>nil</code></td>
</tr>
<tr>
<td>shareToSnsNames</td>
<td>定义列表出现的微博平台字符串构成的数组，字符变量名为UMShareToSina、UMShareToTencent、UMShareToWechatSession、UMShareToWechatTimeline、UMShareToQzone、UMShareToQQ、UMShareToRenren、UMShareToDouban、UMShareToEmail、UMShareToSms、UMShareToFacebook、UMShareToTwitter，分别代表新浪微博、腾讯微博、微信好友、微信朋友圈、QQ空间、手机QQ、人人网、豆瓣、电子邮箱、短信、Facebook、Twitter</td>
</tr>
<tr>
<td>delegate</td>
<td>实现分享状态回调方法的对象，回调方法的实现可以参见分享详细说明的回调方法部分。如果你不需要回调的话，可以设为<code>nil</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意：<br />
弹出横屏页面必须要先使用如下设置屏幕方向的代码，再弹出分享列表页面：<br />
<code>[UMSocialConfig setSupportedInterfaceOrientations:UIInterfaceOrientationMaskLandscape];</code></p>
</blockquote>
<h2>4 <a name="check_result" id="check_result" style="color:black">验证效果</a></h2>
<p>编译并运行后，弹出类似下图的分享列表选择页面，点击某个平台进行授权之后可以进入微博编辑页面，并可以发送微博，说明你已经基本集成成功了。但是，为了使您的用户有更好的分享体验，以及您的应用有更多的分享量，更好地在社交平台上传播，我们建议您按照下面的指引进行SSO（免登录）和新平台的设置。</p>
<table>
<thead>
<tr>
<th><img alt="social" src="http://github.umeng.com/umeng/PicHubRes/raw/master/yeahugo/2013-08/a8cd49.png" title="social_share_list" /></th>
<th><img alt="social" src="http://github.umeng.com/umeng/PicHubRes/raw/master/yeahugo/2013-08/1988c3.png" title="social_share_list" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>列表页面</td>
<td>编辑页面</td>
</tr>
</tbody>
</table>
<h2>5 <a name="share_wechat" id="share_wechat" style="color:black">各平台SSO（免登录）配置</a></h2>
<p>注意：腾讯微博、QQ空间分享使用我们默认应用账号作为分享账号，则不能使用SSO授权功能，因为会导致各个应用设置的url scheme不唯一。    </p>
<h3>步骤1. 添加URL scheme</h3>
<p>在你的工程设置项,targets 一栏下,选中自己的 target,在 Info-&gt;URL Types 中添加 URL Schemes。如果使用的是Xcode3或更低版本，则需要在plist文件中添加。获取各个平台appkey或者appid的方法可以参考分享详细文档绑定各个平台部分，各个平台的url scheme格式如下表：</p>
<table border="1">
  <tr>
    <th> 平台 </th>
    <th>url scheme设置格式</th>
  </tr>
  <tr>
    <td>新浪微博</td>
    <td>“sina.”+友盟appkey，例如“sina.507fcab25270157b37000010”</td>
  </tr>
   <tr>
    <td>腾讯微博</td>
    <td>“wb”+腾讯微博appkey，例如“wb801255122”</td>
  </tr>
   <tr>
    <td>QQ空间</td>
    <td>“tencent“+腾讯QQ互联应用Id，例如“tencent100308348”</td>
  </tr>
   <tr>
    <td>微信</td>
    <td>“wx”+微信应用appId，例如“wxd9a39c7122aa6516”,微信详细集成步骤参考<a href="http://dev.umeng.com/doc/document_social_ios_detail.html#social_wechat" style="text-decoration:none">微信集成方法</a></td>
  </tr>
   <tr>
    <td>手机QQ</td>
    <td>“QQ”+腾讯QQ互联应用appId转换成十六进制（不足8位前面补0），例如“QQ05FA957C”。生成十六进制方法：在命令行输入<div>echo 'ibase=10;obase=16;您的腾讯QQ互联应用Id'|bc</div>，手机QQ详细集成步骤参考<a href="http://dev.umeng.com/doc/document_social_ios_detail.html#social_qq" style="text-decoration:none">手机QQ集成方法</a></td>
  </tr>
</table>

<p><img alt="socialbar" src="http://github.umeng.com/umeng/PicHubRes/raw/master/yeahugo/2013-09/d0d886.png" title="social_sso" /> </p>
<ul>
<li>在AppDelegate文件集成相应的开关方法：</li>
</ul>
<pre><code>#import &quot;UMSocial.h&quot;     
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    //设置微信AppId，url地址为点击图文分享消息跳转地址，若该地址传nil，将默认使用友盟的网址
    [UMSocialConfig setWXAppId:@&quot;wxd9a39c7122aa6516&quot; url:nil];
    //打开Qzone的SSO开关
    [UMSocialConfig setSupportQzoneSSO:YES importClasses:@[[QQApiInterface class],[TencentOAuth class]]];
    //设置手机QQ的AppId，QQ AppId传nil，将使用在友盟配置的Qzone的AppId。url传nil，将使用友盟的网址
    [UMSocialConfig setQQAppId:nil url:nil importClasses:@[[QQApiInterface class],[TencentOAuth class]]];
    //打开新浪微博的SSO开关
    [UMSocialConfig setSupportSinaSSO:YES];
    //打开腾讯微博SSO开关
    [UMSocialConfig setSupportTencentSSO:YES];
}
</code></pre>

<h3>步骤2. 在AppDelegate文件里面实现下面三个系统回调方法：</h3>
<pre><code>  - (void)applicationDidBecomeActive:(UIApplication *)application
{
    [UMSocialSnsService  applicationDidBecomeActive];
}
- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url
{
 return  [UMSocialSnsService handleOpenURL:url wxApiDelegate:nil];  
}
- (BOOL)application:(UIApplication *)application 
              openURL:(NSURL *)url 
    sourceApplication:(NSString *)sourceApplication
           annotation:(id)annotation
 {
 return  [UMSocialSnsService handleOpenURL:url wxApiDelegate:nil];
 }  
</code></pre>

<h3>步骤3. 添加系统库文件（不使用QQ空间和手机QQ的SSO功能可以忽略此步骤）</h3>
<ul>
<li>
<p>添加SDK依赖的系统库文件。</p>
<p>在Xcode中打开工程配置文件，选择“summary”一栏。在“summary”中选择“Linked Frameworks and Libraries”一栏，点击“+”图标添加下面七个库文件，分别是“libiconv.dylib”，“SystemConfiguration.framework”，“CoreGraphics.Framework”、“libsqlite3.dylib”、“CoreTelephony.framework”、“libstdc++.dylib”、“libz.dylib”。</p>
</li>
</ul>
<h2>6 进阶使用</h2>
<p>如果上述文档不能满足你的分享需求，请参看<a href="http://dev.umeng.com/doc/document_social_ios_detail.html" style="text-decoration:none">详细集成文档</a>。</p>